import{r as p,L as x}from"./index-TubBldip.js";function z(e,t,n){let r=i=>e(i,...t);return n===void 0?r:Object.assign(r,{lazy:n,lazyArgs:t})}function S(e,t,n){let r=e.length-t.length;if(r===0)return e(...t);if(r===1)return z(e,t,n);throw Error("Wrong number of arguments")}function E(...e){return S($,e)}function $(e,t){let n={};for(let[r,i]of Object.entries(e))n[r]=t(i,r,e);return n}function j(...e){return S(h,e)}function h(e,t){if(e===t||Object.is(e,t))return!0;if(typeof e!="object"||typeof t!="object"||e===null||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;if(Array.isArray(e))return A(e,t);if(e instanceof Map)return C(e,t);if(e instanceof Set)return L(e,t);if(e instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp)return e.toString()===t.toString();if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let[n,r]of Object.entries(e))if(!(n in t)||!h(r,t[n]))return!1;return!0}function A(e,t){if(e.length!==t.length)return!1;for(let[n,r]of e.entries())if(!h(r,t[n]))return!1;return!0}function C(e,t){if(e.size!==t.size)return!1;for(let[n,r]of e.entries())if(!t.has(n)||!h(r,t.get(n)))return!1;return!0}function L(e,t){if(e.size!==t.size)return!1;let n=[...t];for(let r of e){let i=!1;for(let[s,l]of n.entries())if(h(r,l)){i=!0,n.splice(s,1);break}if(!i)return!1}return!0}let o=[],a=0;const d=4;let O=0;const M=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(r){return n.lc=t.push(r),()=>{for(let s=a+d;s<o.length;)o[s]===r?o.splice(s,d):s+=d;let i=t.indexOf(r);~i&&(t.splice(i,1),--n.lc||n.off())}},notify(r,i){O++;let s=!o.length;for(let l of t)o.push(l,n.value,r,i);if(s){for(a=0;a<o.length;a+=d)o[a](o[a+1],o[a+2],o[a+3]);o.length=0}},off(){},set(r){let i=n.value;i!==r&&(n.value=r,n.notify(i))},subscribe(r){let i=n.listen(r);return r(n.value),i},value:e};return n},R=5,b=6,y=10;let T=(e,t,n,r)=>(e.events=e.events||{},e.events[n+y]||(e.events[n+y]=r(i=>{e.events[n].reduceRight((s,l)=>(l(s),s),{shared:{},...i})})),e.events[n]=e.events[n]||[],e.events[n].push(t),()=>{let i=e.events[n],s=i.indexOf(t);i.splice(s,1),i.length||(delete e.events[n],e.events[n+y](),delete e.events[n+y])}),D=1e3,P=(e,t)=>T(e,n=>{let r=t(n);r&&e.events[b].push(r)},R,n=>{let r=e.listen;e.listen=(...s)=>(!e.lc&&!e.active&&(e.active=!0,n()),r(...s));let i=e.off;return e.events[b]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let s of e.events[b])s();e.events[b]=[]}},D)},()=>{e.listen=r,e.off=i}}),V=(e,t,n)=>{Array.isArray(e)||(e=[e]);let r,i,s=()=>{if(i===O)return;i=O;let c=e.map(u=>u.get());if(!r||c.some((u,g)=>u!==r[g])){r=c;let u=t(...c);u&&u.then&&u.t?u.then(g=>{r===c&&l.set(g)}):(l.set(u),i=O)}},l=M(void 0),f=l.get;l.get=()=>(s(),f());let v=s;return P(l,()=>{let c=e.map(u=>u.listen(v));return s(),()=>{for(let u of c)u()}}),l};const w=(e,t)=>V(e,t);function q(e,t,n){let r=new Set(t).add(void 0);return e.listen((i,s,l)=>{r.has(l)&&n(i,s,l)})}let m=(e,t)=>n=>{e.current!==n&&(e.current=n,t())};function k(e,{keys:t,deps:n=[e,t]}={}){let r=p.useRef();r.current=e.get();let i=p.useCallback(l=>(m(r,l)(e.value),t?.length>0?q(e,t,m(r,l)):e.listen(m(r,l))),n),s=()=>r.current;return p.useSyncExternalStore(i,s,s)}const I=e=>{const t=w(e,f=>x.create(f));function n(f){const v=e.get();if(j(v,f))return;const c={...f,views:E(f.views,u=>{const g=v.views[u.id];return j(g,u)?g:u})};e.set(c)}const r=w(e,f=>Object.values(f.views));function i(){return k(t)}function s(){return k(r)}function l(f){const[v,c]=p.useState(e.value?.views[f]??null);return p.useEffect(()=>e.subscribe(u=>{c(u.views[f]??null)}),[f]),v}return{updateModel:n,$likec4model:t,useLikeC4Model:i,useLikeC4Views:s,useLikeC4View:l}};export{I as H,M};
